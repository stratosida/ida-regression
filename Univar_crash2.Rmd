# Univariate summary CRASH-2 dataset 

```{r,message = FALSE, warning = FALSE }
library(here)
library(tidyverse)
library(janitor)
library(summarytools)
library(Hmisc)
source(here("R", "tmp_hist_plot.R"))

```

## Read data

### Load the dataset.

```{r load_crash2, message = FALSE}
load(here::here("data", "crash2.rda"))
```


Complete metadata by adding missing labels. 

```{r}
crash2 <- Hmisc::upData(crash2,
               labels = c(age = 'Age'),
               units = c(age = "years"))
```



### Describe the dataset

Use Hmisc describe function. 

```{r desc_crash2, message = FALSE, results='asis', warning=FALSE}
crash2 %>%
  Hmisc::describe(descript = "Crash2 data set") %>%
  Hmisc::html()
```


## Univariate summary

### Continous variables

#### Age


Plot age. 



```{r, fig.width=8, fig.height=3.5, fig.cap= "Distribution of subject age [years]" }
ida_plot_all(crash2, "age", n.dodge = 1)
```


```{r, fig.width=8, fig.height=3.5, fig.cap= "Distribution of subject age [years]" }

title <- paste0("Univariate summary of ", with(crash2, label(age)), " [", with(crash2, units(age)), "]")
  
y_axis <- "Number of subjects"
x_axis <- paste0(with(crash2, label(age)), " [", with(crash2, units(age)), "]")

nmiss <- crash2 %>% filter(is.na(age)) %>% tally()
bign <- crash2 %>% filter(!is.na(age)) %>% tally()

caption <- paste0("All observed values, the distribution and the, min, max and interquartile range are reported\n", 
                  bign, " subjects are displayed, with ",
                  nmiss, " subjects with missing values are not presented.")

# for calculating five number summary
x <- with(crash2, as.numeric(age))

p2 <-
  crash2 %>%
  filter(!is.na(age)) %>%
  ggplot2::ggplot(aes(age)) +
  geom_histogram(binwidth = 1,
                 center = 0,
                 alpha = 0.6, fill = "firebrick2") +
  geom_rug() +
  scale_x_continuous(limit = c(min(x), max(x)),
                     breaks = round(fivenum(x), 1)) +
  ylab(y_axis) +
  ggplot2::theme_minimal() +
  theme(
    #axis.title.y = element_text(angle = 0),
    #    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_line(colour = "grey", size = 0.5),
    panel.grid.minor = element_blank(),
    axis.title.x = element_blank()
    #    axis.text.x = element_blank()
  )

p1 <-
  crash2 %>%
  filter(!is.na(age)) %>%
  ggplot(aes(x = age, y = 0)) +
  geom_jitter(width = 0.1,
              height = 0.1,
              alpha = 0.2, color = "firebrick2") +
  geom_rug(sides = "b") +
  scale_x_continuous(limit = c(min(x), max(x)),
                     breaks = round(fivenum(x), 1)) +
  ggplot2::theme_minimal() +
  ylab(y_axis) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank()
  )


p3 <-
  crash2 %>%
  filter(!is.na(age)) %>%
  ggplot(aes(x = age, y = 0)) +
  geom_boxplot(outlier.shape = NA, width = 0.1) +
  scale_x_continuous(limit = c(min(x), max(x)),
                     breaks = c(round(fivenum(x), 1))) +
  xlab(x_axis) +
  ggplot2::theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_blank()
  )

layout <- c(patchwork::area(1, 1, 1, 6),
            patchwork::area(2, 1, 5, 6),
            patchwork::area(6, 1, 6, 6))

gg <- p1 / p2 / p3 +
  patchwork::plot_layout(design = layout) +
  patchwork::plot_annotation(
    title = title,
    caption = caption
  )

gg

```



#### Blood pressure

Plot blood pressure. 

```{r, fig.width=8, fig.height=3.5, fig.cap= "Distribution of SBP" }
source(here("R", "tmp_hist_plot.R"))
ida_plot_all(crash2, "sbp", n.dodge = 1)
```



#### RR


```{r, fig.width=8, fig.height=3.5, fig.cap= "Distribution of respiratory rate" }
source(here("R", "tmp_hist_plot.R"))
ida_plot_all(crash2, "rr", n.dodge = 2)
```


#### RR


```{r, fig.width=8, fig.height=3.5, fig.cap= "Distribution of heart rate" }
ida_plot_all(crash2, "hr", n.dodge = 1)
```




## Session info

```{r}
sessionInfo()
```


